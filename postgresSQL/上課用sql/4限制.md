# PostgreSQL 限制條件 (Constraints)

## 限制條件類型

PostgreSQL 提供多種限制條件來確保資料的完整性和一致性：

- **NOT NULL** - 欄位不可以是空的
- **UNIQUE** - 欄位值不可以重複
- **DEFAULT** - 設定預設值
- **PRIMARY KEY** - 主鍵（唯一且非空）

## 🗑️ 刪除資料表

```sql
DROP TABLE student;
```

## 📝 建立資料表範例

### 基本限制條件

```sql
CREATE TABLE student(
	student_id SERIAL,
	name VARCHAR(20) NOT NULL,/*不可以是NULL*/
	major VARCHAR(20) UNIQUE,/*不可以重覆*/
	PRIMARY KEY(student_id)
);
```

## 🔍 查詢資料

```sql
SELECT * FROM student
```

## ❌ 錯誤範例

### NOT NULL 限制錯誤

```sql
INSERT INTO student VALUES(1, NULL, '英語')
```

**錯誤訊息**: `ERROR: null value in column "name" violates not-null constraint`

### UNIQUE 限制錯誤

```sql
INSERT INTO student VALUES(1, '小白', '英語')
INSERT INTO student VALUES(1, '小黑', '英語')
```

**錯誤訊息**: `ERROR: duplicate key value violates unique constraint`

## 🔧 使用 DEFAULT 預設值

### 建立帶預設值的資料表

```sql
CREATE TABLE student(
	student_id SERIAL,
	name VARCHAR(20),
	major VARCHAR(20) DEFAULT '歷史',/*有預設值*/
	PRIMARY KEY(student_id)
);
```

### 插入資料（使用預設值）

```sql
INSERT INTO student(name) VALUES('小黑');
```

### 插入完整資料

```sql
INSERT INTO student(name, major) VALUES('小黑', '英語');
INSERT INTO student(name, major) VALUES('小白', '歷史');
```

## 📋 資料表結構說明

| 欄位名稱 | 資料類型 | 限制條件 | 說明 |
|---------|---------|---------|------|
| student_id | SERIAL | PRIMARY KEY | 自動遞增的主鍵 |
| name | VARCHAR(20) | NOT NULL | 學生姓名，不可為空 |
| major | VARCHAR(20) | UNIQUE, DEFAULT '歷史' | 主修科目，不可重複，預設為歷史 |

## 💡 實用技巧

### 檢查限制條件

```sql
SELECT 
    conname AS constraint_name,
    contype AS constraint_type,
    pg_get_constraintdef(oid) AS constraint_definition
FROM pg_constraint 
WHERE conrelid = 'student'::regclass;
```

### 移除限制條件

```sql
ALTER TABLE student DROP CONSTRAINT student_major_key;

ALTER TABLE student ALTER COLUMN name DROP NOT NULL;
```

---

## 📚 練習建議

1. **基礎練習**: 先建立簡單的資料表，測試各種限制條件
2. **錯誤處理**: 故意插入違反限制的資料，觀察錯誤訊息
3. **預設值**: 練習使用 DEFAULT 值，了解其便利性
4. **實際應用**: 設計符合實際需求的資料表結構

## ⚠️ 注意事項

- **SERIAL** 類型會自動建立 PRIMARY KEY 和 AUTO_INCREMENT 功能
- **UNIQUE** 限制會自動建立索引，提升查詢效能
- **DEFAULT** 值只在插入時未指定該欄位時才會生效
- 刪除資料表前請確認沒有重要資料

